#!/usr/bin/python
# -*- coding: utf-8 -*-

from bs4 import BeautifulSoup
import requests
import re,sys
import json
import os
# os.path.abspath(os.path.join(os.path.dirname(__file__),".."))
from store_json import *

def get_tr_list(url):
	# 获取html页面，提取所有的'tr'标签
	response = requests.get(url)
	bs = BeautifulSoup(response.text,"html.parser")
	tr_list = bs.find_all('tr')
	return tr_list

def malwaredomainlist(url = 'http://www.malwaredomainlist.com/mdl.php?search=&colsearch=All&quantity=All'):
	# 清洗malwaredomainlist的数据
	tr_list = get_tr_list(url)
	domain_dict ={}
	pattern = re.compile('^[^/]*')
	# pattern_date=re.compile('^[0-9/]+')
	for tr in tr_list[4:]:
		td_list = tr.find_all('td')
		host = pattern.findall(td_list[1].get_text())[0]
		if host != u'-':
			domain_dict[host] = {
			'url':td_list[1].get_text(),
			'subtype':'malware',
			# 'desc_maltype':'[malwaredomain] '+td_list[4].get_text(),
			'source':'http://www.malwaredomainlist.com/mdl.php?search=&colsearch=All&quantity=All'
			}
	return domain_dict

def main():
	dict = malwaredomainlist()
	store_json(dict,'malwaredomainlist')
	# print json.dumps(dict,indent=4)

# if __name__=="__main__":
    # main()